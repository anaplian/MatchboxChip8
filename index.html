<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Matchbox Chip 8 Interpreter</title>
  <meta name="description" content="Matchbox Chip 8 Interpreter">
  <meta name="author" content="Jonathan Lloyd">
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <h1>Matchbox Chip 8 Interpreter</h1>
  <canvas id="stage" width="640px" height="320px" style="border: 1px solid black;">
  </canvas>
  <div>
    <input type="file" id="input" onchange="romUploaded(this.files)">
  </div>
  <div>
    <a href="#" onclick="startRom('ROMS/BLINKY')">BLINKY</a>
  </div>
  <script src="//jdataview.github.io/dist/jdataview.js"></script>
  <script src="//jdataview.github.io/dist/jbinary.js"></script>
  <script src="MatchboxChip8.js"></script>
  <script>
    var drawingContext = document.getElementById("stage").getContext("2d");
    var interpreter = new MatchboxChip8.Interpreter(drawingContext);


    var typeSet = {
      "jBinary.all": ['array', 'uint16'],
    }

    function startRom(romResource) {
      drawingContext.fillText('Loading...', 10, 310);
      jBinary.load(romResource, typeSet, function (err, binary) {
        var rom = binary.readAll();

        interpreter.insertRom(rom);

        drawingContext.clearRect(0, 0, 640, 320);
        drawingContext.fillText(
          'Loaded ' + rom.length + ' instructions',
          10,
          310
        );
      });
    }

    function romUploaded(romFiles) {
      var romFile = romFiles[0];
      startRom(romFile);
    }

  </script>
</body>
</html>
