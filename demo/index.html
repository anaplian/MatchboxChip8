<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Matchbox Chip 8 Emulator</title>
  <meta name="description" content="Matchbox Chip 8 Interpreter">
  <meta name="author" content="Jonathan Lloyd">
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <h1>Matchbox Chip 8 Emulator</h1>
  <canvas id="stage" width="640px" height="320px" style="border: 1px solid black;">
  </canvas>
  <div>
    <input type="file" id="input" onchange="romUploaded(this.files)">
  </div>
  <div>
    <a href="#" onclick="startRom('ROMS/BLINKY')">BLINKY</a>
  </div>
  <button onclick="stepInterpreter()">STEP</button>
  <script src="../dist/MatchboxChip8.js"></script>
  <script>
    var FOREGROUND_COLOR = '#00FF00';
    var BACKGROUND_COLOR = '#000000';

    var drawingContext = document.getElementById("stage").getContext("2d");
    var interpreter = new MatchboxChip8.Interpreter();

    var testProgram = [
      0x6001,
      0x3001,
      0x00e0,
      0x6000,
    ];
    interpreter.loadInstructions(testProgram);
    interpreter.setPixel(0, 0, 1);
    interpreter.setPixel(1, 1, 1);
    interpreter.setPixel(2, 2, 1);
    interpreter.setPixel(3, 3, 1);
    renderDisplay();

    function startRom(rom) {
      interpreter.insertRom(rom);
    }

    function romUploaded(romFiles) {
      var romFile = romFiles[0];
      startRom(romFile);
    }

    function stepInterpreter() {
      interpreter.step();
      renderDisplay();
    }

    function renderDisplay() {
      var cachedFillStyle = drawingContext.fillStyle;

      for(var x = 0; x < 64; x += 1) {
        for(var y = 0; y < 32; y += 1) {
          var pixel = interpreter.getPixel(x, y);
          if(pixel === 1) {
            drawingContext.fillStyle = FOREGROUND_COLOR;
          } else {
            drawingContext.fillStyle = BACKGROUND_COLOR;
          }
          drawingContext.fillRect(x*10, y*10, 10, 10)
        }
      }

      drawingContext.fillStyle = cachedFillStyle;
    }
  </script>
</body>
</html>
